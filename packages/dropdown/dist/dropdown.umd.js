"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});for(var crypto=_interopDefault(require("crypto")),Vue=_interopDefault(require("vue")),deepMerge=_interopDefault(require("deepmerge")),rng=function(){return crypto.randomBytes(16)},byteToHex=[],i=0;i<256;++i)byteToHex[i]=(i+256).toString(16).substr(1);function bytesToUuid(e,t){var i=t||0,n=byteToHex;return[n[e[i++]],n[e[i++]],n[e[i++]],n[e[i++]],"-",n[e[i++]],n[e[i++]],"-",n[e[i++]],n[e[i++]],"-",n[e[i++]],n[e[i++]],"-",n[e[i++]],n[e[i++]],n[e[i++]],n[e[i++]],n[e[i++]],n[e[i++]]].join("")}var bytesToUuid_1=bytesToUuid;function v4(e,t,i){var n=t&&i||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var s=(e=e||{}).random||(e.rng||rng)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t)for(var o=0;o<16;++o)t[n+o]=s[o];return t||bytesToUuid_1(s)}var v4_1=v4,EventBus=new Vue,hasClickedAway=function(e,t){return!e.contains(t.target)},listHelpers={normalize:function(e,t){var i=this;return this.list.map(function(e){var t=Object.assign({},e,{isSelected:e.isSelected||i.value==e.id||!1,isHighlighted:e.isHighlighted||!1});return i.$emit("updateList",t),t})}},optionsHelpers={normalize:function(e){return deepMerge(this.options,this.defaultOptions)},validate:function(e,t){Object.keys(e).forEach(function(e){t.hasOwnProperty(e)||console.error(e+" doesn't seem to be a valid option. valid options are -> "+t)})}},DropdownItem={props:{instanceId:{type:String,required:!0},list:{type:Array,required:!0},item:{type:Object,required:!0}},data:function(){return{isSelected:!1,isHighlighted:!1}},methods:{highlight:function(e){e.isHighlighted=!0},blur:function(e){e.isHighlighted=!1},select:function(e){var t=this.list.find(function(e){return e.isSelected});t&&(t.isSelected=!1),e.isSelected=!e.isSelected,EventBus.$emit("dropdownue:changeValue"+this.instanceId,e.id),this.$emit("change",e.id)},getItemEvents:function(e){var t=this;return{mouseover:function(){t.highlight(e)},mouseout:function(){t.blur(e)},click:function(){t.select(e)}}}},render:function(){var e=this;return this.$scopedSlots.default({isSelected:this.item.isSelected,isHighlighted:this.item.isHighlighted,highlight:this.highlight,itemMouseoverEvent:function(t){return e.getItemEvents(t).mouseover()},itemMouseoutEvent:function(t){return e.getItemEvents(t).mouseout()},itemEvents:this.getItemEvents})}},defaultOptions={closeOnSelect:!0,closeOnClickaway:!0,resetFilterOnSelect:!0,fields:{unique:"id",label:"label"}},Dropdown={name:"GhostaxDropdown",props:{rawList:{type:Array,required:!1},defaultValue:{type:String,required:!1,default:void 0},filterQuery:{type:String,required:!1,default:""},options:{type:Object,required:!1,default:function(){return{}}}},data:function(){return{instanceId:v4_1(),isOpen:!1,normalizedList:[],listItemsToRender:[],value:this.defaultValue}},computed:{nomalizedOptions:function(){return optionsHelpers.validate(this.option,defaultOptions),optionsHelpers.normalize(this.option,defaultOptions)},normalizedList:function(){return listHelpers.normalize(this.list,this.value)}},watch:{isOpen:function(){this.isOpen?(document.addEventListener("click",this.handleClickAway),document.addEventListener("keydown",this.handleClickAway)):(document.removeEventListener("click",this.handleClickAway),document.removeEventListener("keydone",this.handleClickAway))},filterQuery:{immediate:!0,handler:function(e){this.filterList(e)}}},mounted:function(){this.normalizeOptions(),this.listenOnChangeValue()},methods:{normalizeOptions:function(){this.normalizedOptions=optionsHelpers.normalize(this.options)},listenOnChangeValue:function(){var e=this;EventBus.$on("ghostax/dropdown:changeValue"+this.instanceId,function(t){e.select(t)})},handleClickAway:function(e){(hasClickedAway(this.$el,e)||"Escape"===e.key)&&this.close()},open:function(){this.isOpen=!0,this.$emit("open")},close:function(){this.isOpen=!1,this.$emit("close")},toggle:function(){this.isOpen=!this.isOpen,this.$emit("toggle",this.isOpen)},filterList:function(e){this.listItemsToRender=e?this.normalizedList.filter(function(t){return t.name.includes(e)}):this.normalizedList},select:function(e){this.value=e,this.$emit("change",e),this.closeOnSelect&&this.close(),this.resetOnSelect&&this.filterList("")}},render:function(){return this.$scopedSlots.default({isOpen:this.isOpen,isClosed:!this.isOpen,value:this.value,listToRender:this.listItemsToRender,open:this.open,close:this.close,toggle:this.toggle,filter:this.filter})}};exports.Dropdown=Dropdown,exports.DropdownItem=DropdownItem;
