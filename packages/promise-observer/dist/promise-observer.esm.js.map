{"version":3,"file":"promise-observer.esm.js","sources":["../src/_helpers.js","../src/promise-observer.js"],"sourcesContent":["import Vue from 'vue';\n\nconst deepMerge = require('deepmerge');\n\nconst isPromise = (value) => {\n  return Boolean(value && typeof value.then === 'function');\n};\n\nconst optionsHelpers = {\n  normalize(defaultOption) {\n    return Vue.observable(\n      deepMerge(defaultOption, this.options)\n    );\n  },\n  validate(defaultOptions) {\n    Object.keys(this.options).forEach((passedOptionKey) => {\n      if (!defaultOptions.hasOwnProperty(passedOptionKey)) {\n        console.error(`${passedOptionKey} doesn't seem to be a valid option. valid options are -> ${defaultOptions}`);\n      }\n    });\n  }\n};\n\nexport {\n  isPromise,\n  optionsHelpers\n};\n","import { isPromise, optionsHelpers } from './_helpers';\n\nconst defaultOptions = {\n  fields: {\n    data: ''\n  }\n};\n\nexport default {\n  name: 'PromiseObserver',\n  props: {\n    promise: {\n      required: true,\n      validator(value) {\n        return typeof value === 'object' || value === null;\n      }\n    },\n    options: {\n      type: Object,\n      required: false,\n      default() {\n        return {};\n      }\n    }\n  },\n  data() {\n    return {\n      hasFulfilled: false,\n      hasRejected: false,\n      mainData: null,\n      response: null,\n      reason: '',\n      isPending: false\n    };\n  },\n  watch: {\n    promise: {\n      immediate: true,\n      handler() {\n        if (this.hasPromise) {\n          this.getReadyForNewOne();\n          this.observe();\n        }\n      }\n    }\n  },\n  computed: {\n    normalizedOptions() {\n      optionsHelpers.validate.apply(this, [defaultOptions]);\n      return optionsHelpers.normalize.apply(this, [defaultOptions]);\n    },\n    hasPromise() {\n      return !!this.promise && isPromise(this.promise);\n    },\n    state() {\n      if (this.hasRejected) {\n        return 'rejected';\n      }\n      if (this.hasFulfilled) {\n        return 'fulfilled';\n      }\n    }\n  },\n  methods: {\n    getReadyForNewOne() {\n      this.hasFulfilled = false;\n      this.hasRejected = false;\n      this.response = null;\n      this.mainData = null;\n    },\n    observe() {\n      this.isPending = true;\n      this.promise\n        .then((response) => {\n          console.log({ response });\n          this.hasFulfilled = true;\n          this.response = response;\n          this.mainData = response?.[this.normalizedOptions.fields.data] || response;\n          this.$emit('fulfill', response);\n          return response;\n        })\n        .catch((error) => {\n          this.hasRejected = true;\n          this.reason = error;\n          this.$emit('error', error);\n          return error;\n        })\n        .finally(() => {\n          this.isPending = false;\n        });\n    }\n  },\n  render(h) {\n    if (this.hasPromise) {\n      return this.$scopedSlots.default({\n        state: this.state,\n\n        isPending: this.isPending,\n\n        hasFulfilled: this.hasFulfilled,\n        response: this.response,\n        mainData: this.mainData,\n\n        hasRejected: this.hasRejected,\n        reason: this.reason\n      });\n    }\n  }\n};\n"],"names":["deepMerge","require","optionsHelpers","normalize","defaultOption","Vue","observable","this","options","validate","defaultOptions","Object","keys","forEach","passedOptionKey","hasOwnProperty","console","error","fields","data","name","props","promise","required","validator","value","_typeof","type","default","hasFulfilled","hasRejected","mainData","response","reason","isPending","watch","immediate","handler","hasPromise","getReadyForNewOne","observe","computed","normalizedOptions","apply","Boolean","then","state","methods","log","_this","$emit","catch","finally","render","h","$scopedSlots"],"mappings":"wPAEA,IAAMA,EAAYC,QAAQ,aAMpBC,EAAiB,CACrBC,mBAAUC,UACDC,EAAIC,WACTN,EAAUI,EAAeG,KAAKC,WAGlCC,kBAASC,GACPC,OAAOC,KAAKL,KAAKC,SAASK,QAAQ,SAACC,GAC5BJ,EAAeK,eAAeD,IACjCE,QAAQC,gBAASH,sEAA2EJ,QCf9FA,EAAiB,CACrBQ,OAAQ,CACNC,KAAM,mBAIK,CACbC,KAAM,kBACNC,MAAO,CACLC,QAAS,CACPC,UAAU,EACVC,mBAAUC,SACgB,WAAjBC,EAAOD,IAAgC,OAAVA,IAGxCjB,QAAS,CACPmB,KAAMhB,OACNY,UAAU,EACVK,yBACS,MAIbT,sBACS,CACLU,cAAc,EACdC,aAAa,EACbC,SAAU,KACVC,SAAU,KACVC,OAAQ,GACRC,WAAW,IAGfC,MAAO,CACLb,QAAS,CACPc,WAAW,EACXC,mBACM9B,KAAK+B,kBACFC,yBACAC,cAKbC,SAAU,CACRC,oCACExC,EAAeO,SAASkC,MAAMpC,KAAM,CAACG,IAC9BR,EAAeC,UAAUwC,MAAMpC,KAAM,CAACG,KAE/C4B,8BACW/B,KAAKe,UDhDDG,ECgDsBlB,KAAKe,QD/CrCsB,QAAQnB,GAA+B,mBAAfA,EAAMoB,OADrB,IAACpB,GCkDfqB,wBACMvC,KAAKuB,YACA,WAELvB,KAAKsB,aACA,qBAIbkB,QAAS,CACPR,kCACOV,cAAe,OACfC,aAAc,OACdE,SAAW,UACXD,SAAW,MAElBS,mCACON,WAAY,OACZZ,QACFuB,KAAK,SAACb,UACLhB,QAAQgC,IAAI,CAAEhB,SAAAA,IACdiB,EAAKpB,cAAe,EACpBoB,EAAKjB,SAAWA,EAChBiB,EAAKlB,UAAWC,MAAAA,SAAAA,EAAWiB,EAAKP,kBAAkBxB,OAAOC,QAASa,EAClEiB,EAAKC,MAAM,UAAWlB,GACfA,IAERmB,MAAM,SAAClC,UACNgC,EAAKnB,aAAc,EACnBmB,EAAKhB,OAAShB,EACdgC,EAAKC,MAAM,QAASjC,GACbA,IAERmC,QAAQ,WACPH,EAAKf,WAAY,MAIzBmB,gBAAOC,MACD/C,KAAK+B,kBACA/B,KAAKgD,aAAa3B,QAAQ,CAC/BkB,MAAOvC,KAAKuC,MAEZZ,UAAW3B,KAAK2B,UAEhBL,aAActB,KAAKsB,aACnBG,SAAUzB,KAAKyB,SACfD,SAAUxB,KAAKwB,SAEfD,YAAavB,KAAKuB,YAClBG,OAAQ1B,KAAK0B"}