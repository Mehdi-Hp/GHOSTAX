{"version":3,"file":"promise-observer.js","sources":["../src/_helpers.js","../src/promise-observer.js"],"sourcesContent":["import Vue from 'vue';\n\nconst deepMerge = require('deepmerge');\n\nconst isPromise = (value) => {\n  return Boolean(value && typeof value.then === 'function');\n};\n\nconst optionsHelpers = {\n  normalize(defaultOption) {\n    return Vue.observable(\n      deepMerge(defaultOption, this.options)\n    );\n  },\n  validate(defaultOptions) {\n    Object.keys(this.options).forEach((passedOptionKey) => {\n      if (!defaultOptions.hasOwnProperty(passedOptionKey)) {\n        console.error(`${passedOptionKey} doesn't seem to be a valid option. valid options are -> ${defaultOptions}`);\n      }\n    });\n  }\n};\n\nexport {\n  isPromise,\n  optionsHelpers\n};\n","import { isPromise, optionsHelpers } from './_helpers';\n\nconst defaultOptions = {\n  fields: {\n    data: ''\n  }\n};\n\nexport default {\n  name: 'PromiseObserver',\n  props: {\n    promise: {\n      required: true,\n      validator(value) {\n        return typeof value === 'object' || value === null;\n      }\n    },\n    options: {\n      type: Object,\n      required: false,\n      default() {\n        return {};\n      }\n    }\n  },\n  data() {\n    return {\n      hasFulfilled: false,\n      hasRejected: false,\n      mainData: null,\n      response: null,\n      reason: '',\n      isPending: false\n    };\n  },\n  watch: {\n    promise: {\n      immediate: true,\n      handler() {\n        if (this.hasPromise) {\n          this.getReadyForNewOne();\n          this.observe();\n        }\n      }\n    }\n  },\n  computed: {\n    normalizedOptions() {\n      optionsHelpers.validate.apply(this, [defaultOptions]);\n      return optionsHelpers.normalize.apply(this, [defaultOptions]);\n    },\n    hasPromise() {\n      return !!this.promise && isPromise(this.promise);\n    },\n    state() {\n      if (this.hasRejected) {\n        return 'rejected';\n      }\n      if (this.hasFulfilled) {\n        return 'fulfilled';\n      }\n    }\n  },\n  methods: {\n    getReadyForNewOne() {\n      this.hasFulfilled = false;\n      this.hasRejected = false;\n      this.response = null;\n      this.mainData = null;\n    },\n    observe() {\n      this.isPending = true;\n      this.promise\n        .then((response) => {\n          console.log({ response });\n          this.hasFulfilled = true;\n          this.response = response;\n          this.mainData = response?.[this.normalizedOptions.fields.data] || response;\n          this.$emit('fulfill', response);\n          return response;\n        })\n        .catch((error) => {\n          this.hasRejected = true;\n          this.reason = error;\n          this.$emit('error', error);\n          return error;\n        })\n        .finally(() => {\n          this.isPending = false;\n        });\n    }\n  },\n  render(h) {\n    if (this.hasPromise) {\n      return this.$scopedSlots.default({\n        state: this.state,\n\n        isPending: this.isPending,\n\n        hasFulfilled: this.hasFulfilled,\n        response: this.response,\n        mainData: this.mainData,\n\n        hasRejected: this.hasRejected,\n        reason: this.reason\n      });\n    }\n  }\n};\n"],"names":["deepMerge","require","isPromise","value","Boolean","then","optionsHelpers","normalize","defaultOption","Vue","observable","this","options","validate","defaultOptions","Object","keys","forEach","passedOptionKey","hasOwnProperty","console","error","fields","data","name","props","promise","required","validator","_typeof","type","default","hasFulfilled","hasRejected","mainData","response","reason","isPending","watch","immediate","handler","hasPromise","getReadyForNewOne","observe","computed","normalizedOptions","apply","state","methods","log","_this","$emit","catch","finally","render","h","$scopedSlots"],"mappings":"0XAEA,IAAMA,UAAYC,QAAQ,aAEpBC,UAAY,SAACC,UACVC,QAAQD,GAA+B,mBAAfA,EAAME,OAGjCC,eAAiB,CACrBC,mBAAUC,UACDC,IAAIC,WACTV,UAAUQ,EAAeG,KAAKC,WAGlCC,kBAASC,GACPC,OAAOC,KAAKL,KAAKC,SAASK,QAAQ,SAACC,GAC5BJ,EAAeK,eAAeD,IACjCE,QAAQC,gBAASH,sEAA2EJ,QCf9FA,eAAiB,CACrBQ,OAAQ,CACNC,KAAM,qBAIK,CACbC,KAAM,kBACNC,MAAO,CACLC,QAAS,CACPC,UAAU,EACVC,mBAAUzB,SACgB,WAAjB0B,QAAO1B,IAAgC,OAAVA,IAGxCS,QAAS,CACPkB,KAAMf,OACNY,UAAU,EACVI,yBACS,MAIbR,sBACS,CACLS,cAAc,EACdC,aAAa,EACbC,SAAU,KACVC,SAAU,KACVC,OAAQ,GACRC,WAAW,IAGfC,MAAO,CACLZ,QAAS,CACPa,WAAW,EACXC,mBACM7B,KAAK8B,kBACFC,yBACAC,cAKbC,SAAU,CACRC,oCACEvC,eAAeO,SAASiC,MAAMnC,KAAM,CAACG,iBAC9BR,eAAeC,UAAUuC,MAAMnC,KAAM,CAACG,kBAE/C2B,8BACW9B,KAAKe,SAAWxB,UAAUS,KAAKe,UAE1CqB,wBACMpC,KAAKsB,YACA,WAELtB,KAAKqB,aACA,qBAIbgB,QAAS,CACPN,kCACOV,cAAe,OACfC,aAAc,OACdE,SAAW,UACXD,SAAW,MAElBS,mCACON,WAAY,OACZX,QACFrB,KAAK,SAAC8B,UACLf,QAAQ6B,IAAI,CAAEd,SAAAA,IACde,EAAKlB,cAAe,EACpBkB,EAAKf,SAAWA,EAChBe,EAAKhB,UAAWC,MAAAA,SAAAA,EAAWe,EAAKL,kBAAkBvB,OAAOC,QAASY,EAClEe,EAAKC,MAAM,UAAWhB,GACfA,IAERiB,MAAM,SAAC/B,UACN6B,EAAKjB,aAAc,EACnBiB,EAAKd,OAASf,EACd6B,EAAKC,MAAM,QAAS9B,GACbA,IAERgC,QAAQ,WACPH,EAAKb,WAAY,MAIzBiB,gBAAOC,MACD5C,KAAK8B,kBACA9B,KAAK6C,aAAazB,QAAQ,CAC/BgB,MAAOpC,KAAKoC,MAEZV,UAAW1B,KAAK0B,UAEhBL,aAAcrB,KAAKqB,aACnBG,SAAUxB,KAAKwB,SACfD,SAAUvB,KAAKuB,SAEfD,YAAatB,KAAKsB,YAClBG,OAAQzB,KAAKyB"}